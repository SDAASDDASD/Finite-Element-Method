clear;clc;
syms x y lx ly E v 
load Ke.mat
%nx=input('每层x方向单元数：');
%ny=input('每层y方向单元数：');
nx=50;ny=1;
lx=50/nx;ly=1/(3*ny);
%E=6.9e10;v=0.3;
%Node=9*nx*ny+nx*2+ny*6+1;
Node=9*50*1+50*2+1*6+1;
K=zeros(2*Node,2*Node);
G=zeros(16,2*Node);
h=waitbar(0,'请稍等，正在准备计算...');
    %E=Ef;
    G(1:2,1:2)=[0,0;0,0];       %node1
    G(3:4,2*(2*1+1)-1:2*(2*1+1))=[1,0;0,1];       %node2
    G(5:6,2*(154+1)-1:2*(154+1))=[1,0;0,1];       %node3
    G(7:8,2*(152+1)-1:2*(152+1))=[0,0;0,0];       %node4
    G(9:10,2*(2*1)-1:2*(2*1))=[1,0;0,1];       %node5
    G(11:12,2*(102+1)-1:2*(102+1))=[1,0;0,1];       %node6
    G(13:14,2*(153+1)-1:2*(153+1))=[1,0;0,1];       %node7
    G(15:16,2*(101+1)-1:2*(101+1))=[0,0;0,0];       %node8
    K=K+G'*Ke*G;
for i=2:nx*ny
    %E=Ef;
    G(1:2,2*(2*i-1)-1:2*(2*i-1))=[1,0;0,1];       %node1
    G(3:4,2*(2*i+1)-1:2*(2*i+1))=[1,0;0,1];       %node2
    G(5:6,2*(2*i+153)-1:2*(2*i+153))=[1,0;0,1];       %node3
    G(7:8,2*(2*i+151)-1:2*(2*i+151))=[1,0;0,1];       %node4
    G(9:10,2*(2*i)-1:2*(2*i))=[1,0;0,1];       %node5
    G(11:12,2*(102+i)-1:2*(102+i))=[1,0;0,1];       %node6
    G(13:14,2*(2*i+152)-1:2*(2*i+152))=[1,0;0,1];       %node7
    G(15:16,2*(101+i)-1:2*(101+i))=[1,0;0,1];       %node8
    K=K+G'*Ke*G;
    waitbar(i/1000,h,'请等待...');
end 
waitbar(1,h,'已完成');
close(h)

G=zeros(16,2*Node);
    %E=Ef;
    G(1:2,2*(2*1-1+152)-1:2*(2*1-1+152))=[0,0;0,0];       %node1
    G(3:4,2*(2*1+1+152)-1:2*(2*1+1+152))=[1,0;0,1];       %node2
    G(5:6,2*(154+1+152)-1:2*(154+1+152))=[1,0;0,1];       %node3
    G(7:8,2*(152+1+152)-1:2*(152+1+152))=[0,0;0,0];       %node4
    G(9:10,2*(2*1+152)-1:2*(2*1+152))=[1,0;0,1];       %node5
    G(11:12,2*(102+1+152)-1:2*(102+1+152))=[1,0;0,1];       %node6
    G(13:14,2*(153+1+152)-1:2*(153+1+152))=[1,0;0,1];       %node7
    G(15:16,2*(101+1+152)-1:2*(101+1+152))=[0,0;0,0];       %node8
    K=K+G'*Ke*G;
for i=2:nx*ny
    G=zeros(16,2*Node);
    %E=Ef;
    G(1:2,2*(2*i-1+152)-1:2*(2*i-1+152))=[1,0;0,1];       %node1
    G(3:4,2*(2*i+1+152)-1:2*(2*i+1+152))=[1,0;0,1];       %node2
    G(5:6,2*(2*i+153+152)-1:2*(2*i+153+152))=[1,0;0,1];       %node3
    G(7:8,2*(2*i+151+152)-1:2*(2*i+151+152))=[1,0;0,1];       %node4
    G(9:10,2*(2*i+152)-1:2*(2*i+152))=[1,0;0,1];       %node5
    G(11:12,2*(102+i+152)-1:2*(102+i+152))=[1,0;0,1];       %node6
    G(13:14,2*(2*i+152+152)-1:2*(2*i+152+152))=[1,0;0,1];       %node7
    G(15:16,2*(101+i+152)-1:2*(101+i+152))=[1,0;0,1];       %node8
    K=K+G'*Ke*G;
    waitbar(i/1000,h,'请等待...');
end 
waitbar(1,h,'已完成');
close(h)

G=zeros(16,2*Node);
    E=Ef;
    G(1:2,2*(2*1-1+304)-1:2*(2*1-1+304))=[0,0;0,0];       %node1
    G(3:4,2*(2*1+1+304)-1:2*(2*1+1+304))=[1,0;0,1];       %node2
    G(5:6,2*(154+1+304)-1:2*(154+1+304))=[1,0;0,1];       %node3
    G(7:8,2*(152+1+304)-1:2*(152+1+304))=[0,0;0,0];       %node4
    G(9:10,2*(2*1+304)-1:2*(2*1+304))=[1,0;0,1];       %node5
    G(11:12,2*(102+1+304)-1:2*(102+1+304))=[1,0;0,1];       %node6
    G(13:14,2*(153+1+304)-1:2*(153+1+304))=[1,0;0,1];       %node7
    G(15:16,2*(101+1+304)-1:2*(101+1+304))=[0,0;0,0];       %node8
    K=K+G'*Ke*G;
for i=2:nx*ny
    G=zeros(16,2*Node);
    E=Ef;
    G(1:2,2*(2*i-1+304)-1:2*(2*i-1+304))=[1,0;0,1];       %node1
    G(3:4,2*(2*i+1+304)-1:2*(2*i+1+304))=[1,0;0,1];       %node2
    G(5:6,2*(2*i+153+304)-1:2*(2*i+153+304))=[1,0;0,1];       %node3
    G(7:8,2*(2*i+151+304)-1:2*(2*i+151+304))=[1,0;0,1];       %node4
    G(9:10,2*(2*i+304)-1:2*(2*i+304))=[1,0;0,1];       %node5
    G(11:12,2*(102+i+304)-1:2*(102+i+304))=[1,0;0,1];       %node6
    G(13:14,2*(2*i+152+304)-1:2*(2*i+152+304))=[1,0;0,1];       %node7
    G(15:16,2*(101+i+304)-1:2*(101+i+304))=[1,0;0,1];       %node8
    K=K+G'*Ke*G;
    waitbar(i/1000,h,'请等待...');
end 
waitbar(1,h,'已完成');
close(h)
F=zeros(2*Node,1);
F(2*Node,1)=-100;
U=K\F;