clear;clc;
load Ke.mat
%nx=input('每层x方向单元数：');
%ny=input('每层y方向单元数：');
nx=50;ny=1;
lx=50/nx;ly=1/(3*ny);
E=6.9e10;v=0.3;
Ke=subs(Ke);
%Node=9*nx*ny+nx*2+ny*6+1;
Node=9*50*1+50*2+1*6+1;
K=zeros(2*Node,2*Node);

%%%%%%%     layer1
h=waitbar(0,'请稍等，正在准备计算...');
    %E=Ef;
    P=zeros(2*Node,2*Node);
    P(2*(2*1-1)-1:2*(2*1-1),2*(2*1-1)-1:2*(2*1-1))=[1,0;0,1];       %node1
    P(2*(2*1+1)-1:2*(2*1+1),2*(2*1+1)-1:2*(2*1+1))=Ke(3:4,3:4);       %node2
    P(2*(2*1+153)-1:2*(2*1+153),2*(2*1+153)-1:2*(2*1+153))=Ke(5:6,5:6);       %node3
    P(2*(2*1+151)-1:2*(2*1+151),2*(2*1+151)-1:2*(2*1+151))=[1,0;0,1];       %node4
    P(2*(2*1)-1:2*(2*1),2*(2*1)-1:2*(2*1))=Ke(9:10,9:10);       %node5
    P(2*(102+1)-1:2*(102+1),2*(102+1)-1:2*(102+1))=Ke(11:12,11:12);       %node6
    P(2*(2*1+152)-1:2*(2*1+152),2*(2*1+152)-1:2*(2*1+152))=Ke(13:14,13:14);       %node7
    P(2*(101+1)-1:2*(101+1),2*(101+1)-1:2*(101+1))=[1,0;0,1];       %node8
    
    %node2
    P(2*(2*1+1)-1:2*(2*1+1),2*(2*1+153)-1:2*(2*1+153))=Ke(3:4,5:6);             
    P(2*(2*1+1)-1:2*(2*1+1),2*(2*1)-1:2*(2*1))=Ke(3:4,9:10);       
    P(2*(2*1+1)-1:2*(2*1+1),2*(102+1)-1:2*(102+1))=Ke(3:4,11:12);      
    P(2*(2*1+1)-1:2*(2*1+1),2*(2*1+152)-1:2*(2*1+152))=Ke(3:4,13:14);    
    
    P(2*(2*1+153)-1:2*(2*1+153),2*(2*1+1)-1:2*(2*1+1))=Ke(5:6,3:4);       %node3          
    P(2*(2*1+153)-1:2*(2*1+153),2*(2*1)-1:2*(2*1))=Ke(5:6,9:10);       
    P(2*(2*1+153)-1:2*(2*1+153),2*(102+1)-1:2*(102+1))=Ke(5:6,11:12);      
    P(2*(2*1+153)-1:2*(2*1+153),2*(2*1+152)-1:2*(2*1+152))=Ke(5:6,13:14);    
    
    P(2*(2*1)-1:2*(2*1),2*(2*1+1)-1:2*(2*1+1))=Ke(9:10,3:4);       %node5
    P(2*(2*1)-1:2*(2*1),2*(2*1+153)-1:2*(2*1+153))=Ke(9:10,5:6);                 
    P(2*(2*1)-1:2*(2*1),2*(102+1)-1:2*(102+1))=Ke(9:10,11:12);      
    P(2*(2*1)-1:2*(2*1),2*(2*1+152)-1:2*(2*1+152))=Ke(9:10,13:14);    
    
    P(2*(102+1)-1:2*(102+1),2*(2*1+1)-1:2*(2*1+1))=Ke(11:12,3:4);       %node6
    P(2*(102+1)-1:2*(102+1),2*(2*1+153)-1:2*(2*1+153))=Ke(11:12,5:6);             
    P(2*(102+1)-1:2*(102+1),2*(2*1)-1:2*(2*1))=Ke(11:12,9:10);       
    P(2*(102+1)-1:2*(102+1),2*(2*1+152)-1:2*(2*1+152))=Ke(11:12,13:14);    
    
    P(2*(2*1+152)-1:2*(2*1+152),2*(2*1+1)-1:2*(2*1+1))=Ke(13:14,3:4);       %node7
    P(2*(2*1+152)-1:2*(2*1+152),2*(2*1+153)-1:2*(2*1+153))=Ke(13:14,5:6);            
    P(2*(2*1+152)-1:2*(2*1+152),2*(2*1)-1:2*(2*1))=Ke(13:14,9:10);       
    P(2*(2*1+152)-1:2*(2*1+152),2*(102+1)-1:2*(102+1))=Ke(13:14,11:12);      
   
    K=K+P;
for i=2:nx*ny
    %E=Ef;
    P=zeros(2*Node,2*Node);
    P(2*(2*i-1)-1:2*(2*i-1),2*(2*i-1)-1:2*(2*i-1))=Ke(1:2,1:2);       %node1
    P(2*(2*i+1)-1:2*(2*i+1),2*(2*i+1)-1:2*(2*i+1))=Ke(3:4,3:4);       %node2
    P(2*(2*i+153)-1:2*(2*i+153),2*(2*i+153)-1:2*(2*i+153))=Ke(5:6,5:6);       %node3
    P(2*(2*i+151)-1:2*(2*i+151),2*(2*i+151)-1:2*(2*i+151))=Ke(7:8,7:8);       %node4
    P(2*(2*i)-1:2*(2*i),2*(2*i)-1:2*(2*i))=Ke(9:10,9:10);       %node5
    P(2*(102+i)-1:2*(102+i),2*(102+i)-1:2*(102+i))=Ke(11:12,11:12);       %node6
    P(2*(2*i+152)-1:2*(2*i+152),2*(2*i+152)-1:2*(2*i+152))=Ke(13:14,13:14);       %node7
    P(2*(101+i)-1:2*(101+i),2*(101+i)-1:2*(101+i))=Ke(15:16,15:16);       %node8
    
    P(2*(2*i-1)-1:2*(2*i-1),2*(2*i+1)-1:2*(2*i+1))=Ke(1:2,3:4);       %node1
    P(2*(2*i-1)-1:2*(2*i-1),2*(2*i+153)-1:2*(2*i+153))=Ke(1:2,5:6);       
    P(2*(2*i-1)-1:2*(2*i-1),2*(2*i+151)-1:2*(2*i+151))=Ke(1:2,7:8);       
    P(2*(2*i-1)-1:2*(2*i-1),2*(2*i)-1:2*(2*i))=Ke(1:2,9:10);       
    P(2*(2*i-1)-1:2*(2*i-1),2*(102+i)-1:2*(102+i))=Ke(1:2,11:12);      
    P(2*(2*i-1)-1:2*(2*i-1),2*(2*i+152)-1:2*(2*i+152))=Ke(1:2,13:14);    
    P(2*(2*i-1)-1:2*(2*i-1),2*(101+i)-1:2*(101+i))=Ke(1:2,15:16); 
    
    P(2*(2*i+1)-1:2*(2*i+1),2*(2*i-1)-1:2*(2*i-1))=Ke(3:4,1:2);       %node2
    P(2*(2*i+1)-1:2*(2*i+1),2*(2*i+153)-1:2*(2*i+153))=Ke(3:4,5:6);       
    P(2*(2*i+1)-1:2*(2*i+1),2*(2*i+151)-1:2*(2*i+151))=Ke(3:4,7:8);       
    P(2*(2*i+1)-1:2*(2*i+1),2*(2*i)-1:2*(2*i))=Ke(3:4,9:10);       
    P(2*(2*i+1)-1:2*(2*i+1),2*(102+i)-1:2*(102+i))=Ke(3:4,11:12);      
    P(2*(2*i+1)-1:2*(2*i+1),2*(2*i+152)-1:2*(2*i+152))=Ke(3:4,13:14);    
    P(2*(2*i+1)-1:2*(2*i+1),2*(101+i)-1:2*(101+i))=Ke(3:4,15:16);
    
    P(2*(2*i+153)-1:2*(2*i+153),2*(2*i+1)-1:2*(2*i+1))=Ke(5:6,3:4);       %node3
    P(2*(2*i+153)-1:2*(2*i+153),2*(2*i-1)-1:2*(2*i-1))=Ke(1:2,5:6);       
    P(2*(2*i+153)-1:2*(2*i+153),2*(2*i+151)-1:2*(2*i+151))=Ke(5:6,7:8);       
    P(2*(2*i+153)-1:2*(2*i+153),2*(2*i)-1:2*(2*i))=Ke(5:6,9:10);       
    P(2*(2*i+153)-1:2*(2*i+153),2*(102+i)-1:2*(102+i))=Ke(5:6,11:12);      
    P(2*(2*i+153)-1:2*(2*i+153),2*(2*i+152)-1:2*(2*i+152))=Ke(5:6,13:14);    
    P(2*(2*i+153)-1:2*(2*i+153),2*(101+i)-1:2*(101+i))=Ke(5:6,15:16);
    
    P(2*(2*i+151)-1:2*(2*i+151),2*(2*i+1)-1:2*(2*i+1))=Ke(7:8,3:4);       %node4
    P(2*(2*i+151)-1:2*(2*i+151),2*(2*i+153)-1:2*(2*i+153))=Ke(7:8,5:6);       
    P(2*(2*i+151)-1:2*(2*i+151),2*(2*i-1)-1:2*(2*i-1))=Ke(1:2,7:8);       
    P(2*(2*i+151)-1:2*(2*i+151),2*(2*i)-1:2*(2*i))=Ke(7:8,9:10);       
    P(2*(2*i+151)-1:2*(2*i+151),2*(102+i)-1:2*(102+i))=Ke(7:8,11:12);      
    P(2*(2*i+151)-1:2*(2*i+151),2*(2*i+152)-1:2*(2*i+152))=Ke(7:8,13:14);    
    P(2*(2*i+151)-1:2*(2*i+151),2*(101+i)-1:2*(101+i))=Ke(7:8,15:16);
    
    P(2*(2*i)-1:2*(2*i),2*(2*i+1)-1:2*(2*i+1))=Ke(9:10,3:4);       %node5
    P(2*(2*i)-1:2*(2*i),2*(2*i+153)-1:2*(2*i+153))=Ke(9:10,5:6);       
    P(2*(2*i)-1:2*(2*i),2*(2*i+151)-1:2*(2*i+151))=Ke(9:10,7:8);       
    P(2*(2*i)-1:2*(2*i),2*(2*i-1)-1:2*(2*i-1))=Ke(1:2,9:10);       
    P(2*(2*i)-1:2*(2*i),2*(102+i)-1:2*(102+i))=Ke(9:10,11:12);      
    P(2*(2*i)-1:2*(2*i),2*(2*i+152)-1:2*(2*i+152))=Ke(9:10,13:14);    
    P(2*(2*i)-1:2*(2*i),2*(101+i)-1:2*(101+i))=Ke(9:10,15:16);
    
    P(2*(102+i)-1:2*(102+i),2*(2*i+1)-1:2*(2*i+1))=Ke(11:12,3:4);       %node6
    P(2*(102+i)-1:2*(102+i),2*(2*i+153)-1:2*(2*i+153))=Ke(11:12,5:6);       
    P(2*(102+i)-1:2*(102+i),2*(2*i+151)-1:2*(2*i+151))=Ke(11:12,7:8);       
    P(2*(102+i)-1:2*(102+i),2*(2*i)-1:2*(2*i))=Ke(11:12,9:10);       
    P(2*(102+i)-1:2*(102+i),2*(2*i-1)-1:2*(2*i-1))=Ke(1:2,11:12);      
    P(2*(102+i)-1:2*(102+i),2*(2*i+152)-1:2*(2*i+152))=Ke(11:12,13:14);    
    P(2*(102+i)-1:2*(102+i),2*(101+i)-1:2*(101+i))=Ke(11:12,15:16);
    
    P(2*(2*i+152)-1:2*(2*i+152),2*(2*i+1)-1:2*(2*i+1))=Ke(13:14,3:4);       %node7
    P(2*(2*i+152)-1:2*(2*i+152),2*(2*i+153)-1:2*(2*i+153))=Ke(13:14,5:6);       
    P(2*(2*i+152)-1:2*(2*i+152),2*(2*i+151)-1:2*(2*i+151))=Ke(13:14,7:8);       
    P(2*(2*i+152)-1:2*(2*i+152),2*(2*i)-1:2*(2*i))=Ke(13:14,9:10);       
    P(2*(2*i+152)-1:2*(2*i+152),2*(102+i)-1:2*(102+i))=Ke(13:14,11:12);      
    P(2*(2*i+152)-1:2*(2*i+152),2*(2*i-1)-1:2*(2*i-1))=Ke(1:2,13:14);    
    P(2*(2*i+152)-1:2*(2*i+152),2*(101+i)-1:2*(101+i))=Ke(13:14,15:16);
    
    P(2*(101+i)-1:2*(101+i),2*(2*i+1)-1:2*(2*i+1))=Ke(15:16,3:4);       %node8
    P(2*(101+i)-1:2*(101+i),2*(2*i+153)-1:2*(2*i+153))=Ke(15:16,5:6);       
    P(2*(101+i)-1:2*(101+i),2*(2*i+151)-1:2*(2*i+151))=Ke(15:16,7:8);       
    P(2*(101+i)-1:2*(101+i),2*(2*i)-1:2*(2*i))=Ke(15:16,9:10);       
    P(2*(101+i)-1:2*(101+i),2*(102+i)-1:2*(102+i))=Ke(15:16,11:12);      
    P(2*(101+i)-1:2*(101+i),2*(2*i+152)-1:2*(2*i+152))=Ke(15:16,13:14);    
    P(2*(101+i)-1:2*(101+i),2*(2*i-1)-1:2*(2*i-1))=Ke(1:2,15:16);
    
    K=K+P;
    waitbar(i/1000,h,'请等待...');
end 
close(h);


%%%%%%%%%%     layer2
h=waitbar(0,'请稍等，正在准备计算...');
    %E=Ef;
P=zeros(2*Node,2*Node);
    P(2*(2*1-1+152)-1:2*(2*1-1+152),2*(2*1-1+152)-1:2*(2*1-1+152))=[1,0;0,1];       %node1
    P(2*(2*1+1+152)-1:2*(2*1+1+152),2*(2*1+1+152)-1:2*(2*1+1+152))=Ke(3:4,3:4);       %node2
    P(2*(2*1+153+152)-1:2*(2*1+153+152),2*(2*1+153+152)-1:2*(2*1+153+152))=Ke(5:6,5:6);       %node3
    P(2*(2*1+151+152)-1:2*(2*1+151+152),2*(2*1+151+152)-1:2*(2*1+151+152))=[1,0;0,1];       %node4
    P(2*(2*1+152)-1:2*(2*1+152),2*(2*1+152)-1:2*(2*1+152))=Ke(9:10,9:10);       %node5
    P(2*(102+1+152)-1:2*(102+1+152),2*(102+1+152)-1:2*(102+1+152))=Ke(11:12,11:12);       %node6
    P(2*(2*1+152+152)-1:2*(2*1+152+152),2*(2*1+152+152)-1:2*(2*1+152+152))=Ke(13:14,13:14);       %node7
    P(2*(101+1+152)-1:2*(101+1+152),2*(101+1+152)-1:2*(101+1+152))=[1,0;0,1];       %node8
    
    %node2
    P(2*(2*1+1+152)-1:2*(2*1+1+152),2*(2*1+153+152)-1:2*(2*1+153+152))=Ke(3:4,5:6);             
    P(2*(2*1+1+152)-1:2*(2*1+1+152),2*(2*1+152)-1:2*(2*1+152))=Ke(3:4,9:10);       
    P(2*(2*1+1+152)-1:2*(2*1+1+152),2*(102+1+152)-1:2*(102+1+152))=Ke(3:4,11:12);      
    P(2*(2*1+1+152)-1:2*(2*1+1+152),2*(2*1+152+152)-1:2*(2*1+152+152))=Ke(3:4,13:14);    
    
    P(2*(2*1+153+152)-1:2*(2*1+153+152),2*(2*1+1+152)-1:2*(2*1+1+152))=Ke(5:6,3:4);       %node3          
    P(2*(2*1+153+152)-1:2*(2*1+153+152),2*(2*1+152)-1:2*(2*1+152))=Ke(5:6,9:10);       
    P(2*(2*1+153+152)-1:2*(2*1+153+152),2*(102+1+152)-1:2*(102+1+152))=Ke(5:6,11:12);      
    P(2*(2*1+153+152)-1:2*(2*1+153+152),2*(2*1+152+152)-1:2*(2*1+152+152))=Ke(5:6,13:14);    
    
    P(2*(2*1+152)-1:2*(2*1+152),2*(2*1+1+152)-1:2*(2*1+1+152))=Ke(9:10,3:4);       %node5
    P(2*(2*1+152)-1:2*(2*1+152),2*(2*1+153+152)-1:2*(2*1+153+152))=Ke(9:10,5:6);                 
    P(2*(2*1+152)-1:2*(2*1+152),2*(102+1+152)-1:2*(102+1+152))=Ke(9:10,11:12);      
    P(2*(2*1+152)-1:2*(2*1+152),2*(2*1+152+152)-1:2*(2*1+152+152))=Ke(9:10,13:14);    
    
    P(2*(102+1+152)-1:2*(102+1+152),2*(2*1+1+152)-1:2*(2*1+1+152))=Ke(11:12,3:4);       %node6
    P(2*(102+1+152)-1:2*(102+1+152),2*(2*1+153+152)-1:2*(2*1+153+152))=Ke(11:12,5:6);             
    P(2*(102+1+152)-1:2*(102+1+152),2*(2*1+152)-1:2*(2*1+152))=Ke(11:12,9:10);       
    P(2*(102+1+152)-1:2*(102+1+152),2*(2*1+152+152)-1:2*(2*1+152+152))=Ke(11:12,13:14);    
    
    P(2*(2*1+152+152)-1:2*(2*1+152+152),2*(2*1+1+152)-1:2*(2*1+1+152))=Ke(13:14,3:4);       %node7
    P(2*(2*1+152+152)-1:2*(2*1+152+152),2*(2*1+153+152)-1:2*(2*1+153+152))=Ke(13:14,5:6);            
    P(2*(2*1+152+152)-1:2*(2*1+152+152),2*(2*1+152)-1:2*(2*1+152))=Ke(13:14,9:10);       
    P(2*(2*1+152+152)-1:2*(2*1+152+152),2*(102+1+152)-1:2*(102+1+152))=Ke(13:14,11:12);      
   
    K=K+P;
for i=2:nx*ny
    %E=Ef;
    P=zeros(2*Node,2*Node);
    P(2*(2*i-1+152)-1:2*(2*i-1+152),2*(2*i-1+152)-1:2*(2*i-1+152))=Ke(1:2,1:2);       %node1
    P(2*(2*i+1+152)-1:2*(2*i+1+152),2*(2*i+1+152)-1:2*(2*i+1+152))=Ke(3:4,3:4);       %node2
    P(2*(2*i+153+152)-1:2*(2*i+153+152),2*(2*i+153+152)-1:2*(2*i+153+152))=Ke(5:6,5:6);       %node3
    P(2*(2*i+151+152)-1:2*(2*i+151+152),2*(2*i+151+152)-1:2*(2*i+151+152))=Ke(7:8,7:8);       %node4
    P(2*(2*i+152)-1:2*(2*i+152),2*(2*i+152)-1:2*(2*i+152))=Ke(9:10,9:10);       %node5
    P(2*(102+i+152)-1:2*(102+i+152),2*(102+i+152)-1:2*(102+i+152))=Ke(11:12,11:12);       %node6
    P(2*(2*i+152+152)-1:2*(2*i+152+152),2*(2*i+152+152)-1:2*(2*i+152+152))=Ke(13:14,13:14);       %node7
    P(2*(101+i+152)-1:2*(101+i+152),2*(101+i+152)-1:2*(101+i+152))=Ke(15:16,15:16);       %node8
    
    P(2*(2*i-1+152)-1:2*(2*i-1+152),2*(2*i+1+152)-1:2*(2*i+1+152))=Ke(1:2,3:4);       %node1
    P(2*(2*i-1+152)-1:2*(2*i-1+152),2*(2*i+153+152)-1:2*(2*i+153+152))=Ke(1:2,5:6);       
    P(2*(2*i-1+152)-1:2*(2*i-1+152),2*(2*i+151+152)-1:2*(2*i+151+152))=Ke(1:2,7:8);       
    P(2*(2*i-1+152)-1:2*(2*i-1+152),2*(2*i+152)-1:2*(2*i+152))=Ke(1:2,9:10);       
    P(2*(2*i-1+152)-1:2*(2*i-1+152),2*(102+i+152)-1:2*(102+i+152))=Ke(1:2,11:12);      
    P(2*(2*i-1+152)-1:2*(2*i-1+152),2*(2*i+152+152)-1:2*(2*i+152+152))=Ke(1:2,13:14);    
    P(2*(2*i-1+152)-1:2*(2*i-1+152),2*(101+i+152)-1:2*(101+i+152))=Ke(1:2,15:16); 
    
    P(2*(2*i+1+152)-1:2*(2*i+1+152),2*(2*i-1+152)-1:2*(2*i-1+152))=Ke(3:4,1:2);       %node2
    P(2*(2*i+1+152)-1:2*(2*i+1+152),2*(2*i+153+152)-1:2*(2*i+153+152))=Ke(3:4,5:6);       
    P(2*(2*i+1+152)-1:2*(2*i+1+152),2*(2*i+151+152)-1:2*(2*i+151+152))=Ke(3:4,7:8);       
    P(2*(2*i+1+152)-1:2*(2*i+1+152),2*(2*i+152)-1:2*(2*i+152))=Ke(3:4,9:10);       
    P(2*(2*i+1+152)-1:2*(2*i+1+152),2*(102+i+152)-1:2*(102+i+152))=Ke(3:4,11:12);      
    P(2*(2*i+1+152)-1:2*(2*i+1+152),2*(2*i+152+152)-1:2*(2*i+152+152))=Ke(3:4,13:14);    
    P(2*(2*i+1+152)-1:2*(2*i+1+152),2*(101+i+152)-1:2*(101+i+152))=Ke(3:4,15:16);
    
    P(2*(2*i+153+152)-1:2*(2*i+153+152),2*(2*i+1+152)-1:2*(2*i+1+152))=Ke(5:6,3:4);       %node3
    P(2*(2*i+153+152)-1:2*(2*i+153+152),2*(2*i-1+152)-1:2*(2*i-1+152))=Ke(1:2,5:6);       
    P(2*(2*i+153+152)-1:2*(2*i+153+152),2*(2*i+151+152)-1:2*(2*i+151+152))=Ke(5:6,7:8);       
    P(2*(2*i+153+152)-1:2*(2*i+153+152),2*(2*i+152)-1:2*(2*i+152))=Ke(5:6,9:10);       
    P(2*(2*i+153+152)-1:2*(2*i+153+152),2*(102+i+152)-1:2*(102+i+152))=Ke(5:6,11:12);      
    P(2*(2*i+153+152)-1:2*(2*i+153+152),2*(2*i+152+152)-1:2*(2*i+152+152))=Ke(5:6,13:14);    
    P(2*(2*i+153+152)-1:2*(2*i+153+152),2*(101+i+152)-1:2*(101+i+152))=Ke(5:6,15:16);
    
    P(2*(2*i+151+152)-1:2*(2*i+151+152),2*(2*i+1+152)-1:2*(2*i+1+152))=Ke(7:8,3:4);       %node4
    P(2*(2*i+151+152)-1:2*(2*i+151+152),2*(2*i+153+152)-1:2*(2*i+153+152))=Ke(7:8,5:6);       
    P(2*(2*i+151+152)-1:2*(2*i+151+152),2*(2*i-1+152)-1:2*(2*i-1+152))=Ke(1:2,7:8);       
    P(2*(2*i+151+152)-1:2*(2*i+151+152),2*(2*i+152)-1:2*(2*i+152))=Ke(7:8,9:10);       
    P(2*(2*i+151+152)-1:2*(2*i+151+152),2*(102+i+152)-1:2*(102+i+152))=Ke(7:8,11:12);      
    P(2*(2*i+151+152)-1:2*(2*i+151+152),2*(2*i+152+152)-1:2*(2*i+152+152))=Ke(7:8,13:14);    
    P(2*(2*i+151+152)-1:2*(2*i+151+152),2*(101+i+152)-1:2*(101+i+152))=Ke(7:8,15:16);
    
    P(2*(2*i+152)-1:2*(2*i+152),2*(2*i+1+152)-1:2*(2*i+1+152))=Ke(9:10,3:4);       %node5
    P(2*(2*i+152)-1:2*(2*i+152),2*(2*i+153+152)-1:2*(2*i+153+152))=Ke(9:10,5:6);       
    P(2*(2*i+152)-1:2*(2*i+152),2*(2*i+151+152)-1:2*(2*i+151+152))=Ke(9:10,7:8);       
    P(2*(2*i+152)-1:2*(2*i+152),2*(2*i-1+152)-1:2*(2*i-1+152))=Ke(1:2,9:10);       
    P(2*(2*i+152)-1:2*(2*i+152),2*(102+i+152)-1:2*(102+i+152))=Ke(9:10,11:12);      
    P(2*(2*i+152)-1:2*(2*i+152),2*(2*i+152+152)-1:2*(2*i+152+152))=Ke(9:10,13:14);    
    P(2*(2*i+152)-1:2*(2*i+152),2*(101+i+152)-1:2*(101+i+152))=Ke(9:10,15:16);
    
    P(2*(102+i+152)-1:2*(102+i+152),2*(2*i+1+152)-1:2*(2*i+1+152))=Ke(11:12,3:4);       %node6
    P(2*(102+i+152)-1:2*(102+i+152),2*(2*i+153+152)-1:2*(2*i+153+152))=Ke(11:12,5:6);       
    P(2*(102+i+152)-1:2*(102+i+152),2*(2*i+151+152)-1:2*(2*i+151+152))=Ke(11:12,7:8);       
    P(2*(102+i+152)-1:2*(102+i+152),2*(2*i+152)-1:2*(2*i+152))=Ke(11:12,9:10);       
    P(2*(102+i+152)-1:2*(102+i+152),2*(2*i-1+152)-1:2*(2*i-1+152))=Ke(1:2,11:12);      
    P(2*(102+i+152)-1:2*(102+i+152),2*(2*i+152+152)-1:2*(2*i+152+152))=Ke(11:12,13:14);    
    P(2*(102+i+152)-1:2*(102+i+152),2*(101+i+152)-1:2*(101+i+152))=Ke(11:12,15:16);
    
    P(2*(2*i+152+152)-1:2*(2*i+152+152),2*(2*i+1+152)-1:2*(2*i+1+152))=Ke(13:14,3:4);       %node7
    P(2*(2*i+152+152)-1:2*(2*i+152+152),2*(2*i+153+152)-1:2*(2*i+153+152))=Ke(13:14,5:6);       
    P(2*(2*i+152+152)-1:2*(2*i+152+152),2*(2*i+151+152)-1:2*(2*i+151+152))=Ke(13:14,7:8);       
    P(2*(2*i+152+152)-1:2*(2*i+152+152),2*(2*i+152)-1:2*(2*i+152))=Ke(13:14,9:10);       
    P(2*(2*i+152+152)-1:2*(2*i+152+152),2*(102+i+152)-1:2*(102+i+152))=Ke(13:14,11:12);      
    P(2*(2*i+152+152)-1:2*(2*i+152+152),2*(2*i-1+152)-1:2*(2*i-1+152))=Ke(1:2,13:14);    
    P(2*(2*i+152+152)-1:2*(2*i+152+152),2*(101+i+152)-1:2*(101+i+152))=Ke(13:14,15:16);
    
    P(2*(101+i+152)-1:2*(101+i+152),2*(2*i+1+152)-1:2*(2*i+1+152))=Ke(15:16,3:4);       %node8
    P(2*(101+i+152)-1:2*(101+i+152),2*(2*i+153+152)-1:2*(2*i+153+152))=Ke(15:16,5:6);       
    P(2*(101+i+152)-1:2*(101+i+152),2*(2*i+151+152)-1:2*(2*i+151+152))=Ke(15:16,7:8);       
    P(2*(101+i+152)-1:2*(101+i+152),2*(2*i+152)-1:2*(2*i+152))=Ke(15:16,9:10);       
    P(2*(101+i+152)-1:2*(101+i+152),2*(102+i+152)-1:2*(102+i+152))=Ke(15:16,11:12);      
    P(2*(101+i+152)-1:2*(101+i+152),2*(2*i+152+152)-1:2*(2*i+152+152))=Ke(15:16,13:14);    
    P(2*(101+i+152)-1:2*(101+i+152),2*(2*i-1+152)-1:2*(2*i-1+152))=Ke(1:2,15:16);
    
    K=K+P;
    waitbar(i/1000,h,'请等待...');
end 
close(h);



%%%%%%%%%%     layer3
h=waitbar(0,'请稍等，正在准备计算...');
    %E=Ef;
    P=zeros(2*Node,2*Node);
    P(2*(2*1-1+304)-1:2*(2*1-1+304),2*(2*1-1+304)-1:2*(2*1-1+304))=[1,0;0,1];       %node1
    P(2*(2*1+1+304)-1:2*(2*1+1+304),2*(2*1+1+304)-1:2*(2*1+1+304))=Ke(3:4,3:4);       %node2
    P(2*(2*1+153+304)-1:2*(2*1+153+304),2*(2*1+153+304)-1:2*(2*1+153+304))=Ke(5:6,5:6);       %node3
    P(2*(2*1+151+304)-1:2*(2*1+151+304),2*(2*1+151+304)-1:2*(2*1+151+304))=[1,0;0,1];       %node4
    P(2*(2*1+304)-1:2*(2*1+304),2*(2*1+304)-1:2*(2*1+304))=Ke(9:10,9:10);       %node5
    P(2*(102+1+304)-1:2*(102+1+304),2*(102+1+304)-1:2*(102+1+304))=Ke(11:12,11:12);       %node6
    P(2*(2*1+152+304)-1:2*(2*1+152+304),2*(2*1+152+304)-1:2*(2*1+152+304))=Ke(13:14,13:14);       %node7
    P(2*(101+1+304)-1:2*(101+1+304),2*(101+1+304)-1:2*(101+1+304))=[1,0;0,1];       %node8
    
    %node2
    P(2*(2*1+1+304)-1:2*(2*1+1+304),2*(2*1+153+304)-1:2*(2*1+153+304))=Ke(3:4,5:6);             
    P(2*(2*1+1+304)-1:2*(2*1+1+304),2*(2*1+304)-1:2*(2*1+304))=Ke(3:4,9:10);       
    P(2*(2*1+1+304)-1:2*(2*1+1+304),2*(102+1+304)-1:2*(102+1+304))=Ke(3:4,11:12);      
    P(2*(2*1+1+304)-1:2*(2*1+1+304),2*(2*1+152+304)-1:2*(2*1+152+304))=Ke(3:4,13:14);    
    
    P(2*(2*1+153+304)-1:2*(2*1+153+304),2*(2*1+1+304)-1:2*(2*1+1+304))=Ke(5:6,3:4);       %node3          
    P(2*(2*1+153+304)-1:2*(2*1+153+304),2*(2*1+304)-1:2*(2*1+304))=Ke(5:6,9:10);       
    P(2*(2*1+153+304)-1:2*(2*1+153+304),2*(102+1+304)-1:2*(102+1+304))=Ke(5:6,11:12);      
    P(2*(2*1+153+304)-1:2*(2*1+153+304),2*(2*1+152+304)-1:2*(2*1+152+304))=Ke(5:6,13:14);    
    
    P(2*(2*1+304)-1:2*(2*1+304),2*(2*1+1+304)-1:2*(2*1+1+304))=Ke(9:10,3:4);       %node5
    P(2*(2*1+304)-1:2*(2*1+304),2*(2*1+153+304)-1:2*(2*1+153+304))=Ke(9:10,5:6);                 
    P(2*(2*1+304)-1:2*(2*1+304),2*(102+1+304)-1:2*(102+1+304))=Ke(9:10,11:12);      
    P(2*(2*1+304)-1:2*(2*1+304),2*(2*1+152+304)-1:2*(2*1+152+304))=Ke(9:10,13:14);    
    
    P(2*(102+1+304)-1:2*(102+1+304),2*(2*1+1+304)-1:2*(2*1+1+304))=Ke(11:12,3:4);       %node6
    P(2*(102+1+304)-1:2*(102+1+304),2*(2*1+153+304)-1:2*(2*1+153+304))=Ke(11:12,5:6);             
    P(2*(102+1+304)-1:2*(102+1+304),2*(2*1+304)-1:2*(2*1+304))=Ke(11:12,9:10);       
    P(2*(102+1+304)-1:2*(102+1+304),2*(2*1+152+304)-1:2*(2*1+152+304))=Ke(11:12,13:14);    
    
    P(2*(2*1+152+304)-1:2*(2*1+152+304),2*(2*1+1+304)-1:2*(2*1+1+304))=Ke(13:14,3:4);       %node7
    P(2*(2*1+152+304)-1:2*(2*1+152+304),2*(2*1+153+304)-1:2*(2*1+153+304))=Ke(13:14,5:6);            
    P(2*(2*1+152+304)-1:2*(2*1+152+304),2*(2*1+304)-1:2*(2*1+304))=Ke(13:14,9:10);       
    P(2*(2*1+152+304)-1:2*(2*1+152+304),2*(102+1+304)-1:2*(102+1+304))=Ke(13:14,11:12);      
   
    K=K+P;
for i=2:nx*ny
    %E=Ef;
    P=zeros(2*Node,2*Node);
    P(2*(2*i-1+304)-1:2*(2*i-1+304),2*(2*i-1+304)-1:2*(2*i-1+304))=Ke(1:2,1:2);       %node1
    P(2*(2*i+1+304)-1:2*(2*i+1+304),2*(2*i+1+304)-1:2*(2*i+1+304))=Ke(3:4,3:4);       %node2
    P(2*(2*i+153+304)-1:2*(2*i+153+304),2*(2*i+153+304)-1:2*(2*i+153+304))=Ke(5:6,5:6);       %node3
    P(2*(2*i+151+304)-1:2*(2*i+151+304),2*(2*i+151+304)-1:2*(2*i+151+304))=Ke(7:8,7:8);       %node4
    P(2*(2*i+304)-1:2*(2*i+304),2*(2*i+304)-1:2*(2*i+304))=Ke(9:10,9:10);       %node5
    P(2*(102+i+304)-1:2*(102+i+304),2*(102+i+304)-1:2*(102+i+304))=Ke(11:12,11:12);       %node6
    P(2*(2*i+152+304)-1:2*(2*i+152+304),2*(2*i+152+304)-1:2*(2*i+152+304))=Ke(13:14,13:14);       %node7
    P(2*(101+i+304)-1:2*(101+i+304),2*(101+i+304)-1:2*(101+i+304))=Ke(15:16,15:16);       %node8
    
    P(2*(2*i-1+304)-1:2*(2*i-1+304),2*(2*i+1+304)-1:2*(2*i+1+304))=Ke(1:2,3:4);       %node1
    P(2*(2*i-1+304)-1:2*(2*i-1+304),2*(2*i+153+304)-1:2*(2*i+153+304))=Ke(1:2,5:6);       
    P(2*(2*i-1+304)-1:2*(2*i-1+304),2*(2*i+151+304)-1:2*(2*i+151+304))=Ke(1:2,7:8);       
    P(2*(2*i-1+304)-1:2*(2*i-1+304),2*(2*i+304)-1:2*(2*i+304))=Ke(1:2,9:10);       
    P(2*(2*i-1+304)-1:2*(2*i-1+304),2*(102+i+304)-1:2*(102+i+304))=Ke(1:2,11:12);      
    P(2*(2*i-1+304)-1:2*(2*i-1+304),2*(2*i+152+304)-1:2*(2*i+152+304))=Ke(1:2,13:14);    
    P(2*(2*i-1+304)-1:2*(2*i-1+304),2*(101+i+304)-1:2*(101+i+304))=Ke(1:2,15:16); 
    
    P(2*(2*i+1+304)-1:2*(2*i+1+304),2*(2*i-1+304)-1:2*(2*i-1+304))=Ke(3:4,1:2);       %node2
    P(2*(2*i+1+304)-1:2*(2*i+1+304),2*(2*i+153+304)-1:2*(2*i+153+304))=Ke(3:4,5:6);       
    P(2*(2*i+1+304)-1:2*(2*i+1+304),2*(2*i+151+304)-1:2*(2*i+151+304))=Ke(3:4,7:8);       
    P(2*(2*i+1+304)-1:2*(2*i+1+304),2*(2*i+304)-1:2*(2*i+304))=Ke(3:4,9:10);       
    P(2*(2*i+1+304)-1:2*(2*i+1+304),2*(102+i+304)-1:2*(102+i+304))=Ke(3:4,11:12);      
    P(2*(2*i+1+304)-1:2*(2*i+1+304),2*(2*i+152+304)-1:2*(2*i+152+304))=Ke(3:4,13:14);    
    P(2*(2*i+1+304)-1:2*(2*i+1+304),2*(101+i+304)-1:2*(101+i+304))=Ke(3:4,15:16);
    
    P(2*(2*i+153+304)-1:2*(2*i+153+304),2*(2*i+1+304)-1:2*(2*i+1+304))=Ke(5:6,3:4);       %node3
    P(2*(2*i+153+304)-1:2*(2*i+153+304),2*(2*i-1+304)-1:2*(2*i-1+304))=Ke(1:2,5:6);       
    P(2*(2*i+153+304)-1:2*(2*i+153+304),2*(2*i+151+304)-1:2*(2*i+151+304))=Ke(5:6,7:8);       
    P(2*(2*i+153+304)-1:2*(2*i+153+304),2*(2*i+304)-1:2*(2*i+304))=Ke(5:6,9:10);       
    P(2*(2*i+153+304)-1:2*(2*i+153+304),2*(102+i+304)-1:2*(102+i+304))=Ke(5:6,11:12);      
    P(2*(2*i+153+304)-1:2*(2*i+153+304),2*(2*i+152+304)-1:2*(2*i+152+304))=Ke(5:6,13:14);    
    P(2*(2*i+153+304)-1:2*(2*i+153+304),2*(101+i+304)-1:2*(101+i+304))=Ke(5:6,15:16);
    
    P(2*(2*i+151+304)-1:2*(2*i+151+304),2*(2*i+1+304)-1:2*(2*i+1+304))=Ke(7:8,3:4);       %node4
    P(2*(2*i+151+304)-1:2*(2*i+151+304),2*(2*i+153+304)-1:2*(2*i+153+304))=Ke(7:8,5:6);       
    P(2*(2*i+151+304)-1:2*(2*i+151+304),2*(2*i-1+304)-1:2*(2*i-1+304))=Ke(1:2,7:8);       
    P(2*(2*i+151+304)-1:2*(2*i+151+304),2*(2*i+304)-1:2*(2*i+304))=Ke(7:8,9:10);       
    P(2*(2*i+151+304)-1:2*(2*i+151+304),2*(102+i+304)-1:2*(102+i+304))=Ke(7:8,11:12);      
    P(2*(2*i+151+304)-1:2*(2*i+151+304),2*(2*i+152+304)-1:2*(2*i+152+304))=Ke(7:8,13:14);    
    P(2*(2*i+151+304)-1:2*(2*i+151+304),2*(101+i+304)-1:2*(101+i+304))=Ke(7:8,15:16);
    
    P(2*(2*i+304)-1:2*(2*i+304),2*(2*i+1+304)-1:2*(2*i+1+304))=Ke(9:10,3:4);       %node5
    P(2*(2*i+304)-1:2*(2*i+304),2*(2*i+153+304)-1:2*(2*i+153+304))=Ke(9:10,5:6);       
    P(2*(2*i+304)-1:2*(2*i+304),2*(2*i+151+304)-1:2*(2*i+151+304))=Ke(9:10,7:8);       
    P(2*(2*i+304)-1:2*(2*i+304),2*(2*i-1+304)-1:2*(2*i-1+304))=Ke(1:2,9:10);       
    P(2*(2*i+304)-1:2*(2*i+304),2*(102+i+304)-1:2*(102+i+304))=Ke(9:10,11:12);      
    P(2*(2*i+304)-1:2*(2*i+304),2*(2*i+152+304)-1:2*(2*i+152+304))=Ke(9:10,13:14);    
    P(2*(2*i+304)-1:2*(2*i+304),2*(101+i+304)-1:2*(101+i+304))=Ke(9:10,15:16);
    
    P(2*(102+i+304)-1:2*(102+i+304),2*(2*i+1+304)-1:2*(2*i+1+304))=Ke(11:12,3:4);       %node6
    P(2*(102+i+304)-1:2*(102+i+304),2*(2*i+153+304)-1:2*(2*i+153+304))=Ke(11:12,5:6);       
    P(2*(102+i+304)-1:2*(102+i+304),2*(2*i+151+304)-1:2*(2*i+151+304))=Ke(11:12,7:8);       
    P(2*(102+i+304)-1:2*(102+i+304),2*(2*i+304)-1:2*(2*i+304))=Ke(11:12,9:10);       
    P(2*(102+i+304)-1:2*(102+i+304),2*(2*i-1+304)-1:2*(2*i-1+304))=Ke(1:2,11:12);      
    P(2*(102+i+304)-1:2*(102+i+304),2*(2*i+152+304)-1:2*(2*i+152+304))=Ke(11:12,13:14);    
    P(2*(102+i+304)-1:2*(102+i+304),2*(101+i+304)-1:2*(101+i+304))=Ke(11:12,15:16);
    
    P(2*(2*i+152+304)-1:2*(2*i+152+304),2*(2*i+1+304)-1:2*(2*i+1+304))=Ke(13:14,3:4);       %node7
    P(2*(2*i+152+304)-1:2*(2*i+152+304),2*(2*i+153+304)-1:2*(2*i+153+304))=Ke(13:14,5:6);       
    P(2*(2*i+152+304)-1:2*(2*i+152+304),2*(2*i+151+304)-1:2*(2*i+151+304))=Ke(13:14,7:8);       
    P(2*(2*i+152+304)-1:2*(2*i+152+304),2*(2*i+304)-1:2*(2*i+304))=Ke(13:14,9:10);       
    P(2*(2*i+152+304)-1:2*(2*i+152+304),2*(102+i+304)-1:2*(102+i+304))=Ke(13:14,11:12);      
    P(2*(2*i+152+304)-1:2*(2*i+152+304),2*(2*i-1+304)-1:2*(2*i-1+304))=Ke(1:2,13:14);    
    P(2*(2*i+152+304)-1:2*(2*i+152+304),2*(101+i+304)-1:2*(101+i+304))=Ke(13:14,15:16);
    
    P(2*(101+i+304)-1:2*(101+i+304),2*(2*i+1+304)-1:2*(2*i+1+304))=Ke(15:16,3:4);       %node8
    P(2*(101+i+304)-1:2*(101+i+304),2*(2*i+153+304)-1:2*(2*i+153+304))=Ke(15:16,5:6);       
    P(2*(101+i+304)-1:2*(101+i+304),2*(2*i+151+304)-1:2*(2*i+151+304))=Ke(15:16,7:8);       
    P(2*(101+i+304)-1:2*(101+i+304),2*(2*i+304)-1:2*(2*i+304))=Ke(15:16,9:10);       
    P(2*(101+i+304)-1:2*(101+i+304),2*(102+i+304)-1:2*(102+i+304))=Ke(15:16,11:12);      
    P(2*(101+i+304)-1:2*(101+i+304),2*(2*i+152+304)-1:2*(2*i+152+304))=Ke(15:16,13:14);    
    P(2*(101+i+304)-1:2*(101+i+304),2*(2*i-1+304)-1:2*(2*i-1+304))=Ke(1:2,15:16);
    
    K=K+P;
    waitbar(i/1000,h,'请等待...');
end 
close(h);


F=zeros(2*Node,1);
F(2*Node,1)=-100;

%U=K\F;
U=linsolve(K,F);